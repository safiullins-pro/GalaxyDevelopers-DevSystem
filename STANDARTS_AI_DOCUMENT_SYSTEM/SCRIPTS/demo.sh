#!/usr/bin/env bash
# –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã GalaxyDevelopment

set -e

echo "üåå –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø –°–ò–°–¢–ï–ú–´ GALAXYDEVELOPMENT"
echo "========================================="
echo ""

echo "üéØ –≠—Ç–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–∫–∞–∂–µ—Ç:"
echo "  ‚Ä¢ –ó–∞–ø—É—Å–∫ –≤—Å–µ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã"
echo "  ‚Ä¢ –°–æ–∑–¥–∞–Ω–∏–µ 150+ IT-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤"
echo "  ‚Ä¢ –†–∞–±–æ—Ç—É AI-–∞–≥–µ–Ω—Ç–æ–≤"
echo "  ‚Ä¢ –ì–µ–Ω–µ—Ä–∞—Ü–∏—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏"
echo "  ‚Ä¢ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã"
echo ""

read -p "–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –Ω–∞—á–∞–ª–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏..."
echo ""

# –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
echo "üîß –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è"
echo "-----------------------------"

if ! command -v docker &> /dev/null; then
    echo "‚ùå Docker –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker Desktop"
    exit 1
fi

if ! command -v docker-compose &> /dev/null; then
    echo "‚ùå docker-compose –Ω–µ –Ω–∞–π–¥–µ–Ω"  
    exit 1
fi

if ! command -v python3 &> /dev/null; then
    echo "‚ùå Python3 –Ω–µ –Ω–∞–π–¥–µ–Ω"
    exit 1
fi

echo "‚úÖ Docker: —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
echo "‚úÖ docker-compose: —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω" 
echo "‚úÖ Python3: —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
echo ""

# –®–∞–≥ 2: –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã
echo "üöÄ –®–∞–≥ 2: –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã GalaxyDevelopment"
echo "-------------------------------------------"
echo "–ó–∞–ø—É—Å–∫–∞–µ–º –≤—Å—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É..."
echo ""

./scripts/start_agents.sh

echo ""
read -p "–ù–∞–∂–º–∏—Ç–µ Enter –∫–æ–≥–¥–∞ —Å–∏—Å—Ç–µ–º–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è..."
echo ""

# –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
echo "üè• –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã"
echo "-----------------------------------"

./scripts/health_check.sh

echo ""
read -p "–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è..."
echo ""

# –®–∞–≥ 4: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
echo "üè≠ –®–∞–≥ 4: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 150+ IT-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤"
echo "------------------------------------"
echo "–°–æ–∑–¥–∞–µ–º –∑–∞–¥–∞—á–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏..."
echo ""

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è —Å–∫—Ä–∏–ø—Ç–∞
pip3 install kafka-python > /dev/null 2>&1

# –ó–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–≤–µ—á–∞–µ–º 'y')
echo "y" | python3 scripts/generate_processes.py

echo ""
echo "üìä –ó–∞–¥–∞—á–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã! AI-–∞–≥–µ–Ω—Ç—ã –Ω–∞—á–∞–ª–∏ —Ä–∞–±–æ—Ç—É..."
echo ""

# –®–∞–≥ 5: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
echo "üìà –®–∞–≥ 5: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞"
echo "------------------------------"
echo "–°–ª–µ–¥–∏—Ç–µ –∑–∞ —Ä–∞–±–æ—Ç–æ–π –∞–≥–µ–Ω—Ç–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:"
echo ""
echo "üåê –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:"
echo "  ‚Ä¢ Grafana: http://localhost:3000 (admin/galaxy2025)"
echo "  ‚Ä¢ Prometheus: http://localhost:9090"
echo ""

echo "üìä –ú–µ—Ç—Ä–∏–∫–∏ –∞–≥–µ–Ω—Ç–æ–≤:"
echo "  ‚Ä¢ ResearchAgent: http://localhost:8000/metrics"
echo "  ‚Ä¢ ComposerAgent: http://localhost:8001/metrics"
echo ""

echo "üíæ –õ–æ–≥–∏ –∞–≥–µ–Ω—Ç–æ–≤:"
docker-compose logs --tail=20 research-agent
echo ""
docker-compose logs --tail=20 composer-agent

echo ""
read -p "–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤ –ë–î..."
echo ""

# –®–∞–≥ 6: –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –ë–î
echo "üóÑÔ∏è –®–∞–≥ 6: –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤"
echo "------------------------------"

echo "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:"
docker-compose exec -T postgres psql -U galaxy -d galaxydevelopment -c "
SELECT 
    COUNT(*) as total_processes,
    SUM(CASE WHEN status = 'completed' THEN 1 ELSE 0 END) as completed,
    SUM(CASE WHEN status = 'processing' THEN 1 ELSE 0 END) as processing,
    SUM(CASE WHEN status = 'pending' THEN 1 ELSE 0 END) as pending
FROM agent_tasks;
"

echo ""
echo "–°—Ç–∞—Ç—É—Å –∞–≥–µ–Ω—Ç–æ–≤:"
docker-compose exec -T postgres psql -U galaxy -d galaxydevelopment -c "
SELECT agent_name, status, processed_count, error_count, last_ping
FROM agents 
ORDER BY agent_name;
"

echo ""
echo "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:"
docker-compose exec -T postgres psql -U galaxy -d galaxydevelopment -c "
SELECT process_id, doc_type, quality_score, created_at
FROM documentation 
ORDER BY created_at DESC 
LIMIT 10;
"

echo ""

# –®–∞–≥ 7: –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
echo "üìù –®–∞–≥ 7: –ü—Ä–∏–º–µ—Ä —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏"
echo "---------------------------------------------"

# –ü–æ–ª—É—á–∞–µ–º –ø—Ä–∏–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏–∑ –ë–î
echo "–ü–æ–ª—É—á–∞–µ–º –ø—Ä–∏–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞ Incident Management:"
echo ""

docker-compose exec -T postgres psql -U galaxy -d galaxydevelopment -c "
SELECT content 
FROM documentation 
WHERE process_id = '001' AND doc_type = 'composed'
LIMIT 1;
" | head -50

echo ""
echo "... (–¥–æ–∫—É–º–µ–Ω—Ç –æ–±—Ä–µ–∑–∞–Ω –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏) ..."
echo ""

# –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
echo "üìä –§–ò–ù–ê–õ–¨–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–ò"
echo "===================================="

echo "üéØ –ß—Ç–æ –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ:"
echo "  ‚úÖ –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (Kafka, PostgreSQL, Redis)"
echo "  ‚úÖ –†–∞–±–æ—Ç–∞ 5 AI-–∞–≥–µ–Ω—Ç–æ–≤ –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏"
echo "  ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ –∏–∑ 150+ IT-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤"
echo "  ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º ITIL/ISO"
echo "  ‚úÖ –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –º–µ—Ç—Ä–∏–∫"
echo "  ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–∞ Docker"
echo ""

echo "üîÆ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã:"
echo "  ‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤: ITIL 4, ISO/IEC 20000, COBIT, NIST, ISO 27001"
echo "  ‚Ä¢ AI-—É–ª—É—á—à–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ OpenAI GPT-4"
echo "  ‚Ä¢ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Git, Confluence, SharePoint"
echo "  ‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —á–µ–∫-–ª–∏—Å—Ç—ã –∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã"
echo "  ‚Ä¢ –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º"
echo "  ‚Ä¢ –ö–æ–º–∞–Ω–¥–∞ –∏–∑ 35 —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–æ–ª–µ–π"
echo ""

echo "üíª –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ñ–æ–Ω–µ!"
echo "üìà –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º: http://localhost:3000"
echo "üõë –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏: ./scripts/stop_agents.sh"
echo ""

echo "üéâ –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê!"
echo "–°–∏—Å—Ç–µ–º–∞ GalaxyDevelopment –≥–æ—Ç–æ–≤–∞ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!"